<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>WebSocket Chat with Gallery & Media</title>
  <style>
    /* Base Styles */
    * {
      box-sizing: border-box;
    }
    
    body {
      margin: 0;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: linear-gradient(135deg, #6a11cb 0%, #2575fc 100%);
      display: flex;
      flex-direction: column;
      height: 100vh;
      overflow: hidden;
    }

    /* Login Modal */
    #loginModal {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.85);
      display: flex;
      justify-content: center;
      align-items: center;
      z-index: 1000;
      backdrop-filter: blur(5px);
      animation: fadeIn 0.3s ease-out;
    }

    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }

    .modal-content {
      background: white;
      padding: 40px;
      border-radius: 20px;
      width: 90%;
      max-width: 500px;
      box-shadow: 0 20px 60px rgba(0, 0, 0, 0.4);
      transform: translateY(0);
      animation: slideUp 0.4s ease-out;
    }

    @keyframes slideUp {
      from { transform: translateY(30px); opacity: 0; }
      to { transform: translateY(0); opacity: 1; }
    }

    .modal-content h2 {
      margin-top: 0;
      color: #333;
      text-align: center;
      font-size: 28px;
      margin-bottom: 30px;
      background: linear-gradient(90deg, #6a11cb, #2575fc);
      -webkit-text-fill-color: transparent;
    }

    .form-group {
      margin-bottom: 25px;
    }

    .form-group label {
      display: block;
      margin-bottom: 8px;
      font-weight: 600;
      color: #555;
      font-size: 14px;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    .form-group input[type="text"],
    .form-group input[type="url"] {
      width: 100%;
      padding: 14px;
      border: 2px solid #e0e0e0;
      border-radius: 10px;
      font-size: 16px;
      box-sizing: border-box;
      transition: all 0.3s ease;
      font-family: 'Segoe UI', sans-serif;
    }

    .form-group input[type="text"]:focus,
    .form-group input[type="url"]:focus {
      border-color: #2575fc;
      box-shadow: 0 0 0 3px rgba(37, 117, 252, 0.2);
      outline: none;
    }

    .profile-pic-section {
      display: flex;
      align-items: center;
      gap: 20px;
      margin-top: 10px;
    }

    .profile-preview {
      width: 80px;
      height: 80px;
      border-radius: 50%;
      object-fit: cover;
      border: 3px solid #2575fc;
      background: linear-gradient(135deg, #f5f7fa, #c3cfe2);
      display: flex;
      align-items: center;
      justify-content: center;
      color: #777;
      font-size: 14px;
      text-align: center;
      overflow: hidden;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
    }

    .profile-pic-upload {
      flex: 1;
    }

    .profile-pic-upload input[type="file"] {
      width: 100%;
      padding: 10px;
      border: 2px dashed #c3cfe2;
      border-radius: 10px;
      background: #f8f9fa;
      cursor: pointer;
      transition: all 0.3s ease;
    }

    .profile-pic-upload input[type="file"]:hover {
      border-color: #2575fc;
      background: #f0f5ff;
    }

    .start-btn {
      width: 100%;
      padding: 16px;
      background: linear-gradient(90deg, #6a11cb, #2575fc);
      color: white;
      border: none;
      border-radius: 10px;
      font-size: 16px;
      font-weight: 600;
      cursor: pointer;
      margin-top: 10px;
      transition: all 0.3s ease;
      letter-spacing: 0.5px;
      text-transform: uppercase;
      box-shadow: 0 4px 15px rgba(37, 117, 252, 0.3);
    }

    .start-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(37, 117, 252, 0.4);
    }

    .server-url-note {
      font-size: 12px;
      color: #666;
      margin-top: 5px;
      font-style: italic;
    }

    /* Main Layout */
    #mainChat {
      display: flex;
      height: 100%;
      background: white;
      border-radius: 20px;
      margin: 20px;
      overflow: hidden;
      box-shadow: 0 15px 50px rgba(0, 0, 0, 0.2);
      opacity: 0;
      transform: translateY(10px);
      animation: chatAppear 0.5s ease-out 0.2s forwards;
    }

    @keyframes chatAppear {
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    /* Gallery Sidebar */
    .gallery-sidebar {
      width: 350px;
      background: linear-gradient(180deg, #2c3e50 0%, #1a2530 100%);
      color: white;
      padding: 20px;
      display: flex;
      flex-direction: column;
      border-right: 1px solid #34495e;
      box-shadow: 5px 0 15px rgba(0, 0, 0, 0.1);
      overflow-y: auto;
      position: absolute;
      left: 0;
      top: 0;
      bottom: 0;
      z-index: 100;
      transform: translateX(-100%);
      transition: transform 0.3s ease;
    }

    .gallery-sidebar.open {
      transform: translateX(0);
    }

    /* Toggle button for sidebar */
    .sidebar-toggle {
      position: absolute;
      left: 0;
      top: 50%;
      transform: translateY(-50%);
      background: #2c3e50;
      color: white;
      border: none;
      border-radius: 0 10px 10px 0;
      padding: 12px 8px;
      cursor: pointer;
      z-index: 99;
      box-shadow: 2px 0 10px rgba(0, 0, 0, 0.2);
      transition: all 0.3s ease;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .sidebar-toggle:hover {
      background: #34495e;
      padding-left: 12px;
    }

    .sidebar-toggle span {
      font-size: 20px;
      transition: transform 0.3s ease;
    }

    .gallery-sidebar.open + .sidebar-toggle span {
      transform: rotate(180deg);
    }

    .gallery-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
      padding-bottom: 15px;
      border-bottom: 2px solid #34495e;
    }

    .gallery-header h3 {
      margin: 0;
      font-size: 18px;
      color: #ecf0f1;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .gallery-header h3::before {
      content: "??";
      font-size: 20px;
    }

    .gallery-actions {
      display: flex;
      gap: 8px;
      margin-bottom: 15px;
    }

    .action-btn {
      flex: 1;
      background: rgba(255, 255, 255, 0.1);
      border: 1px solid #34495e;
      color: #ecf0f1;
      border-radius: 6px;
      padding: 10px 12px;
      font-size: 13px;
      cursor: pointer;
      transition: all 0.2s;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 6px;
    }

    .action-btn:hover {
      background: rgba(255, 255, 255, 0.15);
      transform: translateY(-2px);
    }

    .action-btn.refresh {
      border-color: #3498db;
      color: #3498db;
    }

    .action-btn.shutdown {
      border-color: #e74c3c;
      color: #e74c3c;
    }

    .upload-section {
      margin-bottom: 25px;
      padding: 15px;
      background: rgba(255, 255, 255, 0.05);
      border-radius: 10px;
      border: 2px dashed #34495e;
    }

    .upload-section h4 {
      margin-top: 0;
      font-size: 14px;
      color: #bdc3c7;
      display: flex;
      align-items: center;
      gap: 8px;
      margin-bottom: 10px;
    }

    .upload-section h4::before {
      content: "??";
    }

    .upload-btn {
      background: #3498db;
      color: white;
      border: none;
      border-radius: 6px;
      padding: 10px 15px;
      font-size: 13px;
      cursor: pointer;
      width: 100%;
      transition: all 0.2s;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
    }

    .upload-btn:hover {
      background: #2980b9;
      transform: scale(1.02);
    }

    .upload-progress {
      margin-top: 10px;
      background: rgba(255, 255, 255, 0.1);
      border-radius: 5px;
      overflow: hidden;
      height: 6px;
      display: none;
    }

    .upload-progress-bar {
      height: 100%;
      background: linear-gradient(90deg, #2ecc71, #27ae60);
      width: 0%;
      transition: width 0.3s ease;
    }

    .upload-status {
      font-size: 12px;
      margin-top: 8px;
      text-align: center;
      color: #95a5a6;
      display: none;
    }

    .listings-container {
      flex: 1;
      overflow-y: auto;
    }

    .listing-item {
      background: rgba(255, 255, 255, 0.1);
      border-radius: 12px;
      padding: 15px;
      margin-bottom: 15px;
      cursor: pointer;
      transition: all 0.3s ease;
      border: 2px solid transparent;
      position: relative;
    }

    .listing-item:hover {
      background: rgba(255, 255, 255, 0.15);
      transform: translateX(5px);
    }

    .listing-item.active {
      background: rgba(52, 152, 219, 0.2);
      border-color: #3498db;
      box-shadow: 0 0 15px rgba(52, 152, 219, 0.3);
    }

    .listing-title {
      font-weight: 600;
      font-size: 16px;
      margin-bottom: 8px;
      color: #ecf0f1;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .listing-description {
      font-size: 13px;
      color: #bdc3c7;
      margin-bottom: 10px;
      line-height: 1.4;
    }

    .listing-meta {
      display: flex;
      justify-content: space-between;
      align-items: center;
      font-size: 11px;
      color: #95a5a6;
    }

    .media-count {
      background: #2ecc71;
      color: white;
      padding: 2px 8px;
      border-radius: 10px;
      font-size: 10px;
      font-weight: bold;
    }

    .selected-badge {
      position: absolute;
      top: -8px;
      right: -8px;
      background: #e74c3c;
      color: white;
      font-size: 10px;
      padding: 3px 8px;
      border-radius: 10px;
      font-weight: bold;
    }

    /* Chat Main Area */
    .chat-main {
      flex: 1;
      display: flex;
      flex-direction: column;
      position: relative;
    }

    /* Header */
    .header {
      background: linear-gradient(90deg, #6a11cb, #2575fc);
      padding: 20px 25px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
      color: white;
      position: relative;
      z-index: 10;
    }

    .user-info, .ai-info {
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .user-name {
      font-weight: 600;
      font-size: 16px;
      background: rgba(255, 255, 255, 0.2);
      padding: 6px 12px;
      border-radius: 20px;
      backdrop-filter: blur(10px);
    }

    .ai-pic {
      width: 36px;
      height: 36px;
      border-radius: 50%;
      object-fit: cover;
      border: 2px solid white;
      box-shadow: 0 3px 8px rgba(0, 0, 0, 0.2);
    }

    .ai-name {
      font-weight: 600;
      font-size: 16px;
      background: rgba(255, 255, 255, 0.2);
      padding: 6px 12px;
      border-radius: 20px;
      backdrop-filter: blur(10px);
    }

    .current-listing {
      font-size: 14px;
      background: rgba(255, 255, 255, 0.2);
      padding: 6px 15px;
      border-radius: 20px;
      backdrop-filter: blur(10px);
      display: flex;
      align-items: center;
      gap: 8px;
      max-width: 300px;
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
    }

    .current-listing::before {
      content: "??";
    }

    /* Chat Container */
    .chat-container {
      flex: 1;
      padding: 25px;
      overflow-y: auto;
      display: flex;
      flex-direction: column;
      gap: 20px;
      background: linear-gradient(180deg, #f8f9fa 0%, #ffffff 100%);
      position: relative;
    }

    /* Chat Background Pattern */
    .chat-container::before {
      content: "";
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background-image: 
        radial-gradient(#e3e3e3 1px, transparent 1px),
        radial-gradient(#e3e3e3 1px, transparent 1px);
      background-size: 40px 40px;
      background-position: 0 0, 20px 20px;
      opacity: 0.15;
      pointer-events: none;
    }

    /* Message Styles */
    .message {
      max-width: 85%;
      display: flex;
      flex-direction: column;
      animation: messageAppear 0.3s ease-out;
    }
    /* ===========================
   DARK MODERN THEME OVERRIDES
   =========================== */

:root {
  --bg-main: #0b0d10;
  --bg-secondary: #11141a;
  --bg-elevated: #161a22;
  --bg-glass: rgba(255, 255, 255, 0.04);

  --text-primary: #eaeaf0;
  --text-secondary: #a1a6b3;
  --text-muted: #6f7482;

  --accent: #4f7cff;
  --accent-2: #7c5cff;
  --danger: #ff5c5c;
  --success: #3ddc97;

  --border-soft: rgba(255, 255, 255, 0.08);
}

/* Body */
body {
  background: radial-gradient(
      circle at top,
      #141824,
      #07090d 70%
  );
  color: var(--text-primary);
}

/* Main Chat Container */
#mainChat {
  background: var(--bg-secondary);
  box-shadow: 0 25px 80px rgba(0, 0, 0, 0.8);
}

/* Header */
.header {
  background: linear-gradient(135deg, #0f1320, #141a2c);
  border-bottom: 1px solid var(--border-soft);
}

/* Chat Area */
.chat-container {
  background: linear-gradient(180deg, #0b0d10, #0e1117);
}

/* Remove background dots */
.chat-container::before {
  opacity: 0;
}

/* Messages */
.bot .bubble {
  background: var(--bg-elevated);
  color: var(--text-primary);
  border: 1px solid var(--border-soft);
}

.user .bubble {
  background: linear-gradient(135deg, var(--accent), var(--accent-2));
}

/* Input Area */
.input-area {
  background: var(--bg-secondary);
  border-top: 1px solid var(--border-soft);
}

.input-area input {
  background: var(--bg-elevated);
  color: var(--text-primary);
  border: 1px solid var(--border-soft);
}

.input-area input::placeholder {
  color: var(--text-muted);
}

.input-area button {
  background: linear-gradient(135deg, var(--accent), var(--accent-2));
}

/* Sidebar */
.gallery-sidebar {
  background: linear-gradient(180deg, #0c0f18, #07090d);
  border-right: 1px solid var(--border-soft);
}

.listing-item {
  background: var(--bg-glass);
  border: 1px solid var(--border-soft);
}

.listing-item.active {
  background: rgba(79, 124, 255, 0.15);
  border-color: var(--accent);
}

/* Upload Section */
.upload-section {
  background: var(--bg-glass);
  border-color: var(--border-soft);
}

/* Buttons */
.action-btn.refresh {
  color: var(--accent);
  border-color: var(--accent);
}

.action-btn.shutdown {
  color: var(--danger);
  border-color: var(--danger);
}

/* Typing Indicator */
.typing-indicator {
  background: var(--bg-elevated);
  border: 1px solid var(--border-soft);
}

@media (max-width: 768px) {
  body {
    overflow: hidden;
  }

  #mainChat {
    margin: 0;
    border-radius: 0;
    height: 100vh;
  }

  .gallery-sidebar {
    width: 85%;
    max-width: 320px;
  }

  .header {
    padding: 14px;
    flex-wrap: wrap;
    gap: 8px;
  }

  .current-listing {
    max-width: 100%;
    font-size: 12px;
  }

  .chat-container {
    padding: 15px;
  }

  .message {
    max-width: 95%;
  }

  .input-area {
    padding: 12px;
    gap: 10px;
  }

  .input-area button {
    padding: 14px 18px;
  }
}
@media (max-width: 480px) {
  .user-name,
  .ai-name {
    font-size: 13px;
    padding: 4px 10px;
  }

  .bubble {
    font-size: 14px;
    padding: 14px;
  }

  .media-grid {
    grid-template-columns: repeat(2, 1fr);
  }

  .sidebar-toggle {
    padding: 10px 6px;
  }

  .upload-btn {
    font-size: 12px;
    padding: 10px;
  }
}


    @keyframes messageAppear {
      from {
        opacity: 0;
        transform: translateY(10px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .message.user {
      align-self: flex-end;
    }

    .message.bot {
      align-self: flex-start;
    }

    .message-header {
      display: flex;
      align-items: center;
      gap: 10px;
      margin-bottom: 8px;
      padding: 0 5px;
    }

    .message-header .profile-pic {
      width: 32px;
      height: 32px;
      border-radius: 50%;
      object-fit: cover;
      border: 2px solid white;
      box-shadow: 0 2px 6px rgba(0, 0, 0, 0.15);
    }

    .message-header .name {
      font-weight: 600;
      font-size: 14px;
      color: #555;
    }

    .user .message-header .name {
      color: #6a11cb;
    }

    .bot .message-header .name {
      color: #2575fc;
    }

    .bubble {
      padding: 16px 20px;
      border-radius: 20px;
      line-height: 1.5;
      word-wrap: break-word;
      box-shadow: 0 4px 15px rgba(0, 0, 0, 0.08);
      position: relative;
      font-size: 15px;
    }

    .user .bubble {
      background: linear-gradient(135deg, #6a11cb, #2575fc);
      color: white;
      border-bottom-right-radius: 5px;
    }

    .user .bubble::after {
      content: '';
      position: absolute;
      bottom: 0;
      right: -10px;
      width: 20px;
      height: 20px;
      background: linear-gradient(135deg, transparent 50%, #6a11cb 50%);
      border-radius: 0 0 0 20px;
    }

    .bot .bubble {
      background: white;
      color: #333;
      border: 1px solid #e0e0e0;
      border-bottom-left-radius: 5px;
    }

    .bot .bubble::after {
      content: '';
      position: absolute;
      bottom: 0;
      left: -10px;
      width: 20px;
      height: 20px;
      background: linear-gradient(135deg, white 50%, transparent 50%);
      border-radius: 0 0 20px 0;
    }

    /* Media in Chat */
    .media-container {
      margin-top: 15px;
      border-radius: 10px;
      overflow: hidden;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
      max-width: 400px;
    }

    .media-item {
      width: 100%;
      max-height: 300px;
      object-fit: contain;
      background: #000;
    }

    .media-label {
      font-size: 12px;
      color: #666;
      margin-top: 8px;
      font-style: italic;
      padding: 0 5px;
    }

    .media-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
      gap: 10px;
      margin-top: 15px;
    }

    .media-grid-item {
      width: 100%;
      height: 100px;
      border-radius: 8px;
      overflow: hidden;
      cursor: pointer;
      transition: transform 0.3s ease;
      position: relative;
    }

    .media-grid-item:hover {
      transform: scale(1.05);
    }

    .media-grid-item img, 
    .media-grid-item video {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }

    .media-grid-item .play-icon {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      font-size: 24px;
      color: white;
      background: rgba(0, 0, 0, 0.7);
      width: 40px;
      height: 40px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    /* Typing Indicator */
    .typing-indicator {
      align-self: flex-start;
      background: white;
      padding: 16px 20px;
      border-radius: 20px;
      box-shadow: 0 4px 15px rgba(0, 0, 0, 0.08);
      border: 1px solid #e0e0e0;
      display: flex;
      align-items: center;
      gap: 10px;
      margin-bottom: 10px;
      animation: typingAppear 0.3s ease-out;
    }

    @keyframes typingAppear {
      from {
        opacity: 0;
        transform: translateY(10px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .typing-indicator .profile-pic {
	max-width:fitcontent;
      width: auto;
      height: auto;
      border-radius: 50%;
      object-fit: cover;
      border: 2px solid #2575fc;
    }

    .typing-dots {
      display: flex;
      gap: 4px;
    }

    .typing-dots span {
      width: 8px;
      height: 8px;
      border-radius: 50%;
      background: #6a11cb;
      opacity: 0.4;
      animation: typingAnimation 1.4s infinite ease-in-out;
    }

    .typing-dots span:nth-child(1) { animation-delay: -0.32s; }
    .typing-dots span:nth-child(2) { animation-delay: -0.16s; }
    .typing-dots span:nth-child(3) { animation-delay: 0s; }

    @keyframes typingAnimation {
      0%, 60%, 100% { transform: translateY(0); opacity: 0.4; }
      30% { transform: translateY(-8px); opacity: 1; }
    }

    /* Input Area */
    .input-area {
      display: flex;
      padding: 20px 25px;
      background: white;
      border-top: 1px solid #eaeaea;
      box-shadow: 0 -5px 20px rgba(0, 0, 0, 0.05);
      position: relative;
      z-index: 10;
    }

    .input-area input {
      flex: 1;
      padding: 16px 20px;
      font-size: 16px;
      border: 2px solid #e0e0e0;
      border-radius: 50px;
      outline: none;
      transition: all 0.3s ease;
      font-family: 'Segoe UI', sans-serif;
      background: #f8f9fa;
    }

    .input-area input:focus {
      border-color: #2575fc;
      background: white;
      box-shadow: 0 0 0 4px rgba(37, 117, 252, 0.1);
    }

    .input-area button {
      margin-left: 15px;
      padding: 16px 30px;
      font-size: 16px;
      font-weight: 600;
      background: linear-gradient(90deg, #6a11cb, #2575fc);
      color: white;
      border: none;
      border-radius: 50px;
      cursor: pointer;
      transition: all 0.3s ease;
      box-shadow: 0 4px 15px rgba(37, 117, 252, 0.3);
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .input-area button:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(37, 117, 252, 0.4);
    }

    .input-area button:active {
      transform: translateY(0);
    }

    /* Scrollbar Styling */
    .chat-container::-webkit-scrollbar,
    .gallery-sidebar::-webkit-scrollbar {
      width: 8px;
    }

    .chat-container::-webkit-scrollbar-track,
    .gallery-sidebar::-webkit-scrollbar-track {
      background: rgba(0, 0, 0, 0.05);
      border-radius: 4px;
    }

    .chat-container::-webkit-scrollbar-thumb {
      background: linear-gradient(180deg, #6a11cb, #2575fc);
      border-radius: 4px;
    }

    .gallery-sidebar::-webkit-scrollbar-thumb {
      background: #34495e;
      border-radius: 4px;
    }

    /* Hidden class */
    .hidden {
      display: none !important;
    }

    /* Timestamp */
    .message-time {
      font-size: 11px;
      color: #999;
      margin-top: 4px;
      padding: 0 5px;
      text-align: right;
      font-weight: 500;
    }

    .user .message-time {
      text-align: right;
    }

    .bot .message-time {
      text-align: left;
    }

    /* File input styling */
    #zipUpload {
      display: none;
    }
  </style>
</head>
<body>

  <!-- Login Modal -->
  <div id="loginModal">
    <div class="modal-content">
      <h2>Start Chatting</h2>
      
      <div class="form-group">
        <label for="userName">Your Name</label>
        <input type="text" id="userName" placeholder="Enter your name" value="User" />
      </div>
      
      <div class="form-group">
        <label for="aiName">AI Assistant Name</label>
        <input type="text" id="aiName" placeholder="Enter AI name" value="AI Assistant" />
      </div>
      
      <div class="form-group">
        <label>AI Profile Picture (Optional)</label>
        <div class="profile-pic-section">
          <div id="aiProfilePreview" class="profile-preview">
            No Image
          </div>
          <div class="profile-pic-upload">
            <input type="file" id="aiProfilePic" accept="image/*" />
          </div>
        </div>
      </div>
      <button class="start-btn" onclick="startChat()">Start Chat</button>
    </div>
  </div>

  <!-- Main Chat Interface -->
  <div id="mainChat" class="hidden">
    <!-- Sidebar Toggle Button -->
    <button class="sidebar-toggle" onclick="toggleSidebar()">
      <span>?</span>
    </button>
    
    <!-- Gallery Sidebar -->
    <div class="gallery-sidebar">
      <div class="gallery-header">
        <h3>Media Gallery</h3>
      </div>
      
      <!-- Action Buttons -->
      <div class="gallery-actions">
        <button class="action-btn refresh" onclick="refreshListings()">
          <span>??</span> Restart
        </button>
        <button class="action-btn shutdown" onclick="shutdownServer()">
          <span>?</span> Shutdown
        </button>
      </div>
      
      <div class="upload-section">
        <h4>Upload ZIP File</h4>
        <input type="file" id="zipUpload" accept=".zip" />
        <button class="upload-btn" onclick="document.getElementById('zipUpload').click()">
          <span>??</span> Upload ZIP
        </button>
        <div class="upload-progress">
          <div class="upload-progress-bar"></div>
        </div>
        <div class="upload-status"></div>
      </div>
      
      <div class="listings-container" id="listingsContainer">
        <!-- Listings will be loaded here -->
      </div>
    </div>
    
    <!-- Chat Main Area -->
    <div class="chat-main">
      <!-- Header -->
      <div class="header">
        <div class="user-info">
          <span>??</span>
          <span id="displayUserName" class="user-name">User</span>
        </div>
        
        <div class="current-listing" id="currentListingDisplay">
          No listing selected
        </div>
        
        <div class="ai-info">
          <img id="displayAiPic" class="ai-pic" src="" alt="AI" />
          <span id="displayAiName" class="ai-name">AI Assistant</span>
        </div>
      </div>

      <!-- Chat Messages -->
      <div id="chat" class="chat-container">
        <!-- Messages will be added here dynamically -->
      </div>

      <!-- Typing Indicator -->
      <div id="typingIndicator" class="typing-indicator hidden">
        <img id="typingAiPic" class="profile-pic" src="" alt="AI" />
        <div class="typing-dots">
          <span></span>
          <span></span>
          <span></span>
        </div>
      </div>

      <!-- Input Area -->
      <div class="input-area">
        <input id="messageInput" type="text" placeholder="Type your message here..." />
        <button onclick="sendMessage()">
          <span>Send</span>
          <span style="margin-left: 8px;">?</span>
        </button>
      </div>
    </div>
  </div>

  <script>
    // DOM Elements
    const loginModal = document.getElementById("loginModal");
    const mainChat = document.getElementById("mainChat");
    const chat = document.getElementById("chat");
    const input = document.getElementById("messageInput");
    const typingIndicator = document.getElementById("typingIndicator");
    const typingAiPic = document.getElementById("typingAiPic");
    const listingsContainer = document.getElementById("listingsContainer");
    const currentListingDisplay = document.getElementById("currentListingDisplay");
    const zipUploadInput = document.getElementById("zipUpload");
    const sidebar = document.querySelector('.gallery-sidebar');
    
    // User/AI Info
    let userName = "User";
    let aiName = "AI Assistant";
    let aiProfilePic = null;
    let backendUrl = "https://codersmitramandal.shop";
    
    // WebSocket connection
    let socket = null;
    
    // Current state
    let currentListing = null;
    let currentListingFiles = [];
    let allListings = [];
    let conversationHistory = [];
    
    // Media file extensions
    const IMAGE_EXTENSIONS = ['.jpg', '.jpeg', '.png', '.gif', '.bmp', '.webp'];
    const VIDEO_EXTENSIONS = ['.mp4', '.webm', '.mov', '.avi', '.mkv'];
    
    // Handle AI profile picture upload
    document.getElementById("aiProfilePic").addEventListener("change", function(event) {
      const file = event.target.files[0];
      if (file) {
        const reader = new FileReader();
        reader.onload = function(e) {
          aiProfilePic = e.target.result;
          document.getElementById("aiProfilePreview").innerHTML = 
            `<img src="${aiProfilePic}" style="width:100%;height:100%;border-radius:50%;object-fit:cover;" alt="AI" />`;
        };
        reader.readAsDataURL(file);
      }
    });
    
    // Toggle sidebar function
    function toggleSidebar() {
        sidebar.classList.toggle('open');
        document.querySelector('.sidebar-toggle span').textContent =
        sidebar.classList.contains('open') ? '?' : '?';
    }

    
    // Refresh listings function
    async function refreshListings() {
      try {
        const response = await fetch(backendUrl + '/ayc/restart', {
          method: 'GET'
        });
        
        if (response.ok) {
          const data = await response.json();
          allListings = data.folders.map(folder => ({
            name: folder,
            description: `Media collection uploaded on ${new Date().toLocaleDateString()}`,
            files: []
          }));
          
          // For each listing, get the files
          for (let listing of allListings) {
            try {
              const filesResponse = await fetch(backendUrl + '/ayc/list-files/' + listing.name);
              if (filesResponse.ok) {
                const filesData = await filesResponse.json();
                listing.files = filesData.files || [];
              }
            } catch (error) {
              console.error(`Error loading files for ${listing.name}:`, error);
            }
          }
          
          renderListings();
          showUploadStatus('Listings refreshed successfully!', 'success');
          
          // If current listing still exists, keep it selected
          if (currentListing) {
            const updatedListing = allListings.find(l => l.name === currentListing.name);
            if (updatedListing) {
              selectListing(updatedListing);
            }
          }
        } else {
          showUploadStatus('Failed to refresh listings', 'error');
        }
      } catch (error) {
        console.error('Error refreshing listings:', error);
        showUploadStatus('Error refreshing listings: ' + error.message, 'error');
      }
    }
    
    // Shutdown server function
    async function shutdownServer() {
      if (!confirm('Are you sure you want to shutdown the server? This will terminate the backend service.')) {
        return;
      }
      
      try {
        const response = await fetch(backendUrl + '/ayc/shutdown', {
          method: 'GET'
        });
        
        if (response.ok) {
          showUploadStatus('Server shutdown initiated...', 'success');
          addMessage('Server shutdown initiated. The backend service will stop shortly.', 'bot', aiName, aiProfilePic);
          
          // Close WebSocket connection
          if (socket && socket.readyState === WebSocket.OPEN) {
            socket.close();
          }
        } else {
          showUploadStatus('Failed to shutdown server', 'error');
        }
      } catch (error) {
        console.error('Error shutting down server:', error);
        showUploadStatus('Error: ' + error.message, 'error');
      }
    }
    
    // Handle ZIP file upload
    zipUploadInput.addEventListener("change", async function(event) {
      const file = event.target.files[0];
      if (!file) return;
      
      if (!file.name.endsWith('.zip')) {
        showUploadStatus('Please select a ZIP file', 'error');
        return;
      }
      
      await uploadZipFile(file);
    });
    
    async function uploadZipFile(file) {
      const formData = new FormData();
      formData.append('file', file);
      
      const progressBar = document.querySelector('.upload-progress-bar');
      const progressContainer = document.querySelector('.upload-progress');
      const statusElement = document.querySelector('.upload-status');
      
      progressContainer.style.display = 'block';
      statusElement.style.display = 'block';
      statusElement.textContent = 'Uploading...';
      progressBar.style.width = '30%';
      
      try {
        const response = await fetch(backendUrl + '/ayc/upload-zip', {
          method: 'POST',
          body: formData
        });
        
        progressBar.style.width = '70%';
        
        if (!response.ok) {
          throw new Error(`Upload failed: ${response.status}`);
        }
        
        const result = await response.json();
        progressBar.style.width = '100%';
        statusElement.textContent = 'Upload successful! Loading listing...';
        
        // Load the newly uploaded listing
        await loadListings();
        
        // Find and select the new listing
        const newListing = allListings.find(l => l.name === result.folder);
        if (newListing) {
          selectListing(newListing);
        }
        
        setTimeout(() => {
          progressContainer.style.display = 'none';
          statusElement.style.display = 'none';
          progressBar.style.width = '0%';
        }, 2000);
        
      } catch (error) {
        console.error('Upload error:', error);
        progressBar.style.width = '0%';
        statusElement.textContent = `Error: ${error.message}`;
        statusElement.style.color = '#e74c3c';
        
        setTimeout(() => {
          progressContainer.style.display = 'none';
          statusElement.style.display = 'none';
        }, 3000);
      }
    }
    
    function showUploadStatus(message, type = 'info') {
      const statusElement = document.querySelector('.upload-status');
      statusElement.textContent = message;
      statusElement.style.color = type === 'error' ? '#e74c3c' : 
                                 type === 'success' ? '#2ecc71' : '#95a5a6';
      statusElement.style.display = 'block';
      
      setTimeout(() => {
        statusElement.style.display = 'none';
      }, 3000);
    }
    
    // Start chat function
    async function startChat() {
      // Get user input
      userName = document.getElementById("userName").value.trim() || "User";
      aiName = document.getElementById("aiName").value.trim() || "AI Assistant";
      backendUrl = "https://codersmitramandal.shop";
      
      // Update display
      document.getElementById("displayUserName").textContent = userName;
      document.getElementById("displayAiName").textContent = aiName;
      
      // Update AI profile picture if selected
      if (aiProfilePic) {
        document.getElementById("displayAiPic").src = aiProfilePic;
        typingAiPic.src = aiProfilePic;
      } else {
        // Set default AI avatar
        const defaultAvatar = "https://ui-avatars.com/api/?name=" + encodeURIComponent(aiName) + "&background=2575fc&color=fff&size=128";
        document.getElementById("displayAiPic").src = defaultAvatar;
        typingAiPic.src = defaultAvatar;
      }
      
      // Hide login modal, show chat
      loginModal.classList.add("hidden");
      mainChat.classList.remove("hidden");
      
      // Load listings from server
      await loadListings();
      
      // Initialize WebSocket connection
      initializeWebSocket();
      
      // Focus on input
      setTimeout(() => {
        input.focus();
      }, 300);
    }
    
    // Load listings from server
    async function loadListings() {
      try {
        // First, get all folders in the uploaded_files directory
        const response = await fetch(backendUrl + '/ayc/list-folders', {
          method: 'GET'
        });
        
        if (response.ok) {
          const data = await response.json();
          allListings = data.folders.map(folder => ({
            name: folder,
            description: `Media collection uploaded on ${new Date().toLocaleDateString()}`,
            files: []
          }));
          
          // For each listing, get the files
          for (let listing of allListings) {
            try {
              const filesResponse = await fetch(backendUrl + '/ayc/list-files/' + listing.name);
              if (filesResponse.ok) {
                const filesData = await filesResponse.json();
                listing.files = filesData.files || [];
              }
            } catch (error) {
              console.error(`Error loading files for ${listing.name}:`, error);
            }
          }
          
          renderListings();
        } else {
          // If list-folders endpoint doesn't exist, use fallback
          throw new Error('List folders endpoint not found');
        }
      } catch (error) {
        console.error('Error loading listings:', error);
        // Fallback to sample data if server is not available
        allListings = [
          {
            name: "sample_listing",
            description: "Sample media collection with images and videos",
            files: ["image1.jpg", "image2.png", "video1.mp4", "image3.webp"]
          }
        ];
        renderListings();
      }
    }
    
    // Render listings in sidebar
    function renderListings() {
      listingsContainer.innerHTML = '';
      
      if (allListings.length === 0) {
        listingsContainer.innerHTML = `
          <div style="text-align: center; padding: 20px; color: #95a5a6;">
            No listings available. Upload a ZIP file to get started.
          </div>
        `;
        return;
      }
      
      allListings.forEach(listing => {
        const listingElement = document.createElement('div');
        listingElement.className = `listing-item ${currentListing?.name === listing.name ? 'active' : ''}`;
        listingElement.innerHTML = `
          <div class="listing-title">${listing.name}</div>
          <div class="listing-description">${listing.description}</div>
          <div class="listing-meta">
            <span>${formatDate(new Date())}</span>
            <span class="media-count">${listing.files.length} files</span>
          </div>
          ${currentListing?.name === listing.name ? '<div class="selected-badge">Selected</div>' : ''}
        `;
        
        listingElement.addEventListener('click', () => selectListing(listing));
        listingsContainer.appendChild(listingElement);
      });
    }
    
    // Select a listing
    async function selectListing(listing) {
      currentListing = listing;
      currentListingFiles = listing.files.filter(file => 
        isMediaFile(file)
      );
      
      // Update display
      currentListingDisplay.textContent = `?? ${listing.name} (${currentListingFiles.length} media files)`;
      
      // Update active state in sidebar
      document.querySelectorAll('.listing-item').forEach(item => {
        item.classList.remove('active');
      });
      
      const selectedItem = Array.from(document.querySelectorAll('.listing-item'))
        .find(item => item.querySelector('.listing-title').textContent === listing.name);
      
      if (selectedItem) {
        selectedItem.classList.add('active');
        selectedItem.innerHTML = selectedItem.innerHTML.replace(
          '<div class="selected-badge">Selected</div>',
          ''
        );
        selectedItem.innerHTML += '<div class="selected-badge">Selected</div>';
      }
    }
    
    // Check if file is media
    function isMediaFile(filename) {
      const ext = filename.toLowerCase().substring(filename.lastIndexOf('.'));
      return IMAGE_EXTENSIONS.includes(ext) || VIDEO_EXTENSIONS.includes(ext);
    }
    
    // Get random media from current listing
    function getRandomMedia(count = 1) {
      if (!currentListingFiles.length) return [];
      
      const shuffled = [...currentListingFiles].sort(() => 0.5 - Math.random());
      return shuffled.slice(0, Math.min(count, shuffled.length));
    }
    
    // Get file URL for display
    function getFileUrl(filename) {
      return backendUrl + '/ayc/read-file/' + currentListing.name + '/' + encodeURIComponent(filename);
    }
    
    // Initialize WebSocket connection
    function initializeWebSocket() {
      // Use WebSocket URL from backend
      const wsUrl = "wss://codersmitramandal.shop/ayc/personal_chat";
      socket = new WebSocket(wsUrl);
      
      socket.onopen = () => {
        console.log("WebSocket connected");
        // Add a welcome message from AI
        setTimeout(() => {
          addMessage(`Hey ${userName}! How are you doing today? I'm ${aiName}, ready to chat with you!`, "bot", aiName, aiProfilePic);
        }, 800);
      };
      
      socket.onmessage = (event) => {
        const data = JSON.parse(event.data);
        // Hide typing indicator
        typingIndicator.classList.add("hidden");
        
        if (data.response) {
          // Check if we should add media to this response
          const shouldAddMedia = Math.random() > 0.5 && currentListingFiles.length > 0;
          
          if (shouldAddMedia) {
            const randomMedia = getRandomMedia(Math.floor(Math.random() * 2) + 1);
            addMessageWithMedia(data.response, randomMedia, "bot", aiName, aiProfilePic);
          } else {
            addMessage(data.response, "bot", aiName, aiProfilePic);
          }
        } else if (data.error) {
          addMessage("Error: " + data.error, "bot", aiName, aiProfilePic);
        }
      };
      
      socket.onerror = (err) => {
        console.error("WebSocket error:", err);
        typingIndicator.classList.add("hidden");
        addMessage("Connection error. Please try again.", "bot", aiName, aiProfilePic);
      };
    }
    
    // Send message function
    function sendMessage() {
      const text = input.value.trim();
      if (!text || !socket || socket.readyState !== WebSocket.OPEN) return;
      
      // Add user message
      addMessage(text, "user", userName, null);
      
      // Send via WebSocket
      socket.send(JSON.stringify({
        question: text
      }));
      
      // Show typing indicator
      typingIndicator.classList.remove("hidden");
      
      input.value = "";
      input.focus();
    }
    
    // Add message to chat
    function addMessage(text, senderType, senderName, senderPic) {
      const messageDiv = createMessageElement(text, senderType, senderName, senderPic);
      chat.appendChild(messageDiv);
      chat.scrollTop = chat.scrollHeight;
      
      // Add to conversation history
      conversationHistory.push({
        type: senderType,
        name: senderName,
        text: text,
        timestamp: new Date()
      });
    }
    
    // Add message with media
    function addMessageWithMedia(text, mediaFiles, senderType, senderName, senderPic) {
      const messageDiv = createMessageElement(text, senderType, senderName, senderPic);
      
      // Add media container
      if (mediaFiles.length > 0) {
        const mediaContainer = document.createElement('div');
        mediaContainer.className = 'media-container';
        
        if (mediaFiles.length === 1) {
          // Single media file
          const mediaFile = mediaFiles[0];
          const ext = mediaFile.toLowerCase().substring(mediaFile.lastIndexOf('.'));
          
          if (IMAGE_EXTENSIONS.includes(ext)) {
            mediaContainer.innerHTML = `
              <img class="media-item" src="${getFileUrl(mediaFile)}" alt="${mediaFile}" />
              <div class="media-label">From ${currentListing.name}: ${mediaFile}</div>
            `;
          } else if (VIDEO_EXTENSIONS.includes(ext)) {
            mediaContainer.innerHTML = `
              <video class="media-item" controls>
                <source src="${getFileUrl(mediaFile)}" type="video/${ext.substring(1)}">
                Your browser does not support the video tag.
              </video>
              <div class="media-label">From ${currentListing.name}: ${mediaFile}</div>
            `;
          }
        } else {
          // Multiple media files - show as grid
          const mediaGrid = document.createElement('div');
          mediaGrid.className = 'media-grid';
          
          mediaFiles.forEach(mediaFile => {
            const ext = mediaFile.toLowerCase().substring(mediaFile.lastIndexOf('.'));
            const gridItem = document.createElement('div');
            gridItem.className = 'media-grid-item';
            
            if (IMAGE_EXTENSIONS.includes(ext)) {
              gridItem.innerHTML = `
                <img src="${getFileUrl(mediaFile)}" alt="${mediaFile}" />
              `;
            } else if (VIDEO_EXTENSIONS.includes(ext)) {
              gridItem.innerHTML = `
                <video>
                  <source src="${getFileUrl(mediaFile)}" type="video/${ext.substring(1)}">
                </video>
                <div class="play-icon">?</div>
              `;
            }
            
            mediaGrid.appendChild(gridItem);
          });
          
          mediaContainer.appendChild(mediaGrid);
          const label = document.createElement('div');
          label.className = 'media-label';
          label.textContent = `From ${currentListing.name} collection`;
          mediaContainer.appendChild(label);
        }
        
        messageDiv.appendChild(mediaContainer);
      }
      
      chat.appendChild(messageDiv);
      chat.scrollTop = chat.scrollHeight;
      
      // Add to conversation history
      conversationHistory.push({
        type: senderType,
        name: senderName,
        text: text,
        media: mediaFiles,
        timestamp: new Date()
      });
    }
    
    // Create message element
    function createMessageElement(text, senderType, senderName, senderPic) {
      const messageDiv = document.createElement("div");
      messageDiv.className = `message ${senderType}`;
      
      // Create message header with name and profile picture
      const headerDiv = document.createElement("div");
      headerDiv.className = "message-header";
      
      // Add profile picture if available
      let picSrc = senderPic;
      if (!picSrc && senderType === "bot") {
        picSrc = "https://ui-avatars.com/api/?name=" + encodeURIComponent(senderName) + "&background=2575fc&color=fff&size=128";
      }
      
      if (senderType === "bot" && picSrc) {
        headerDiv.innerHTML = `<img class="profile-pic" src="${picSrc}" alt="${senderName}" />
                               <span class="name">${senderName}</span>`;
      } else {
        headerDiv.innerHTML = `<span class="name">${senderName}</span>`;
      }
      
      // Create message bubble
      const bubbleDiv = document.createElement("div");
      bubbleDiv.className = "bubble";
      bubbleDiv.textContent = text;
      
      // Create timestamp
      const timeDiv = document.createElement("div");
      timeDiv.className = "message-time";
      const now = new Date();
      const timeString = now.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
      timeDiv.textContent = timeString;
      
      // Assemble message
      messageDiv.appendChild(headerDiv);
      messageDiv.appendChild(bubbleDiv);
      messageDiv.appendChild(timeDiv);
      
      return messageDiv;
    }
    
    // Format date
    function formatDate(date) {
      return date.toLocaleDateString('en-US', { 
        month: 'short', 
        day: 'numeric',
        year: 'numeric'
      });
    }
    
    // Send on Enter key
    input.addEventListener("keydown", (e) => {
      if (e.key === "Enter") {
        sendMessage();
      }
    });
    
    // Allow closing modal with Escape key (for testing)
    document.addEventListener("keydown", (e) => {
      if (e.key === "Escape" && !mainChat.classList.contains("hidden")) {
        input.focus();
      }
    });
    document.addEventListener('click', (e) => {
    if (
        sidebar.classList.contains('open') &&
        !sidebar.contains(e.target) &&
        !e.target.closest('.sidebar-toggle')
    ) {
        sidebar.classList.remove('open');
        document.querySelector('.sidebar-toggle span').textContent = '?';
    }
    });
  </script>

</body>
</html>
